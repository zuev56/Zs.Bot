using Microsoft.EntityFrameworkCore;
using Microsoft.Extensions.Logging;

namespace Zs.Bot.DbModel
{
    public class ZsBotContext : DbContext
    {
        private static DbContextOptions<ZsBotContext> _options;
        private static ILogger _logger;

        public virtual DbSet<DbChat> Chats { get; set; }
        public virtual DbSet<DbRole> Roles { get; set; }
        public virtual DbSet<DbUser> Users { get; set; }
        public virtual DbSet<DbMessageType> MessageTypes { get; set; }
        public virtual DbSet<DbReceivedMsg> ReceivedMessages { get; set; }
        public virtual DbSet<DbSentMsg> SentMessages { get; set; }
        public virtual DbSet<DbSession> Sessions { get; set; }
        internal virtual DbSet<DbLog> Log { get; set; }
        public virtual DbSet<DbCommand> Commands { get; set; }
        public virtual DbSet<DbSqlResult> SqlResults { get; set; }


        /// <summary> Предоставляет возможность работы с БД, 
        /// используя статические опции, которые должны были быть ранее определены методом Initialize(...) </summary>
        public ZsBotContext()
            : base(_options)
        {
        }

        /// <summary> Инициализация </summary>
        /// <param name="options">Опции, которые будут использоваться при вызове конструктора без параметров</param>
        public static void Initialize(DbContextOptions<ZsBotContext> options, ILogger logger)
        {
            _logger = logger;
            _options = options;
        }

        //protected override void OnConfiguring(DbContextOptionsBuilder optionsBuilder)
        //{
        //    optionsBuilder.UseNpgsql(ConnectionString);
        //}
    }
}
